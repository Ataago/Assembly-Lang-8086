;8b.	Display the system time on a 7-segment display interface.  

;@author Mohammed Ataaur Rahaman

.MODEL SMALL
.DATA

PA EQU 0D800H
PB EQU 0D801H
PC EQU 0D802H
CW EQU 0D803H

HO DB ?
M DB ?
S DB ?
MS DB ?

TABLE DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H

.CODE
MOV AX,@DATA
MOV DS,AX

MOV DX,CW
MOV AL,80H		;All ports are outputs
OUT DX,AL

MOV AH,2CH		;read system time
INT 21H
MOV HO,CH
MOV M,CL
MOV S,DH
MOV MS,DL

MOV AL,M		;HH:MM
CALL UNPACK
MOV AL,HO
CALL UNPACK

CALL DELAY

MOV AL,MS		;SS:MS
CALL UNPACK
MOV AL,S
CALL UNPACK

MOV AH,4CH
INT 21H

UNPACK PROC NEAR
	AAM				;ASCII Codes for multiplication
	CALL DISPLAY
	MOV AL,AH
	CALL DISPLAY
	RET
UNPACK ENDP

DISPLAY PROC NEAR
	LEA BX,TABLE	;match the bcd number
	XLAT
	
	MOV BL,08D
	SEGMENTS:
		ROL AL,01H
		MOV DX,PB
		OUT DX,AL
		
		PUSH AX
		MOV DX,PC
		MOV AL,00H
		OUT DX,AL
		MOV AL,01H
		OUT DX,AL
		POP AX
		
		DEC BL
	JNZ SEGMENTS
	RET
DISPLAY ENDP

DELAY PROC NEAR
	PUSH SI
	PUSH DI
	
	MOV SI,0FFFFH
	Outer: 
		MOV DI,0FFFFH
		Inner:
			DEC DI
		JNZ Inner
		DEC SI
	JNZ Outer
	
	POP DI
	POP SI
	RET
DELAY ENDP

END